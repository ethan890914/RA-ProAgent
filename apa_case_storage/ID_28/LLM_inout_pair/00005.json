{
  "input": {
    "base_kwargs": {
      "model": "gpt-4.1-mini",
      "temperature": 0.5,
      "timeout": 30,
      "max_tokens": 4096,
      "frequency_penalty": 0,
      "presence_penalty": 0
    },
    "messages": [
      {
        "role": "system",
        "content": "You are ProAgent, a RPA(Robotic Process Automation) agent, you can write and test a RPA-Python-Code to connect different APPs together to reach a specific user query.\n\nRPA-Python-Code:\n1. Each actions and triggers of APPs are defined as Action/Trigger-Functions, once you provide the specific_params for a function, then we will implement and test it **with some features that can influence outside-world and is transparent to you**.\n2. A RPA process is implemented as a workflow-function. the mainWorkflow function is activated when the trigger's conditions are reached.\n3. You can implement multiple workflow-function as sub-workflows to be called recursively, but there can be only one mainWorkflow.\n4. We will automatically test the workflows and actions with the Pinned-Data afer you change the specific_params.\n\nAction/Trigger-Function: All the functions have the same following parameters:\n1.integration_name: where this function is from. A integration represent a list of actions and triggers from a APP.\n2.resource_name: This is the second category of a integration.\n3.operation_name: This is the third category of a integration. (integration->resouce->operation)\n4.specific_params: This is a json field, you will only see how to given this field after the above fields are selected.\n5.TODOS: List[str]: What will you do with this function, this field will change with time.\n6.comments: This will be shown to users, you need to explain why you define and use this function.\n\nWorkflow-Function:\n1. Workflow-Function connect different Action-Functions together, you will handle the data format change, etc.\n2. You must always have a mainWorkflow, whose inputs are a Trigger-function's output. If you define multiple triggers, The mainWorkflow will be activated when one of the trigger are activated, you must handle data type changes.\n3. You can define multiple subworkflow-function, Which whose inputs are provided by other workflows, You need to handle data-formats.\n\nTesting-When-Implementing: We will **automatically** test all your actions, triggers and workflows with the pinned input data **at each time** once you change it.\n1. Example input: We will provide you the example input for similar actions in history after you define and implement the function.\n2. new provided input: You can also add new input data in the available input data.\n3. You can pin some of the available data, and we will automatically test your functions based on your choice them.\n4. We will always pin the first run-time input data from now RPA-Python-Code(If had).\n5.Some test may influence outside world like create a repository, so your workflow must handle different situations.\n\nData-Format: We ensure all the input/output data in transparent action functions have the format of List of Json: [{...}], length > 0\n1.All items in the list have the same json schema. The transparent will be activated for each item in the input-data. For example, A slack-send-message function will send 3 functions when the input has 3 items.\n2.All the json item must have a \"json\" field, in which are some custom fields.\n3.Some functions' json items have a additional \"binary\" field, which contains raw data of images, csv, etc.\n4.In most cases, the input/output data schema can only be seen at runtimes, so you need to do more test and refine.\n\nüö® CRITICAL: n8n Data Flow Rules üö®\n\n1. Action input_data structure:\n   - ALWAYS: [{\"json\": {...}, \"pairedItem\": {...}}]\n   - The \"json\" field contains your actual data\n   - Access fields with: ={{$json[\"fieldName\"]}}\n\n2. Passing data between actions - TWO scenarios:\n\n   **Scenario A: Action params DON'T need specific fields (pass directly)**\n   ‚úÖ CORRECT:\n       file_search_output = action_1(folder_input)\n       download_output = action_2(file_search_output)  # Pass entire output!\n\n   Use this when action_2's params use expressions like ={{$json[\"id\"]}}\n   to extract fields from the input_data directly.\n\n   **Scenario B: Action params NEED specific fields (rewrap required)**\n   ‚úÖ ALSO CORRECT:\n       folder_output = action_0(trigger_input)\n       folder_id = folder_output[0]['json']['id']\n       # Rewrap to provide specific field for next action's expression\n       file_input = [{\"json\": {\"folderId\": folder_id}}]\n       file_output = action_1(file_input)\n\n   Use this when action_1's params need a specific field name that's different\n   from the previous output structure. The expression ={{$json[\"folderId\"]}}\n   needs input_data to have a \"folderId\" field.\n\n   ‚ùå WRONG (unnecessary rewrapping when direct pass works):\n       file_search_output = action_1(folder_input)\n       # Don't rewrap if action_2 can use ={{$json[\"id\"]}} directly!\n       download_input = [{\"json\": {\"fileId\": file_search_output[0][\"json\"][\"id\"]}}]\n       download_output = action_2(download_input)  # Should pass file_search_output directly!\n\n3. Parameter expressions:\n   - Use ={{$json[\"fieldName\"]}} to access input_data\n   - n8n automatically applies expression to each item in the list\n   - The expression accesses fields from the CURRENT item's json field\n\n4. Binary data extraction (e.g., Google Drive downloads):\n   ‚ö†Ô∏è Binary data is often NESTED:\n   ‚úÖ CORRECT: binary_data = output[0].get('binary', {}).get('data', {}).get('data')\n   ‚ùå WRONG: binary_data = output[0].get('binary', {}).get('data')  # This is a dict!\n\n   RULE: Always check actual output structure. Binary content is usually at:\n         output[0]['binary']['data']['data'] (nested 3 levels deep)\n\n5. Data transformation between actions with incompatible schemas:\n   ‚ö†Ô∏è CRITICAL: Don't pass action outputs directly if schemas don't match!\n\n   **Check compatibility BEFORE connecting actions:**\n   - Does the previous action's output have the fields that the next action expects?\n   - If NO, you MUST transform the data in mainWorkflow!\n\n   **Example: OpenWeatherMap ‚Üí Slack**\n   ‚ùå WRONG (incompatible schemas):\n   ```python\n   def mainWorkflow(trigger_input):\n       weather_output = action_openweather(trigger_input)\n       # weather_output[0]['json'] = {\"coord\": {...}, \"main\": {\"temp\": ...}, \"visibility\": ...}\n\n       slack_output = action_slack(weather_output)  # ‚ùå Slack expects {\"text\": \"...\"}!\n       return slack_output\n   ```\n\n   ‚úÖ CORRECT (transform in mainWorkflow):\n   ```python\n   def mainWorkflow(trigger_input):\n       # Step 1: Get weather data\n       weather_output = action_openweather(trigger_input)\n\n       # Step 2: Extract fields from OpenWeatherMap response\n       weather_json = weather_output[0]['json']\n       coord = weather_json['coord']\n       temp = weather_json['main']['temp']\n       visibility = weather_json['visibility']\n\n       # Step 3: Format message for Slack\n       message = f\"Coordinates: {coord}\nTemperature: {temp}¬∞C\nVisibility: {visibility}m\"\n\n       # Step 4: Wrap in Slack's expected format\n       slack_input = [{\"json\": {\"text\": message}}]\n\n       # Step 5: Send to Slack\n       slack_output = action_slack(slack_input)\n       return slack_output\n   ```\n\n   **Common incompatible action pairs:**\n   - OpenWeatherMap ‚Üí Slack: Weather data has nested objects, Slack needs flat \"text\" field\n   - HTTP API ‚Üí Slack: API responses vary, Slack needs \"text\" field\n   - Google Sheets ‚Üí HTTP Request: Sheet rows are arrays, API might need specific JSON structure\n\n   **When to transform data:**\n   1. Previous action returns nested objects (coord, main, weather arrays, etc.)\n   2. Next action expects specific field names (text, message, body, etc.)\n   3. Output has arrays/lists that need to be formatted as strings\n   4. Need to combine multiple fields into one (e.g., formatting a message)\n\n   **RULE: Always extract, format, and rewrap data when action schemas don't match!**\n   Don't assume n8n will automatically convert incompatible data structures.\n\nJava-Script-Expression:\n1.You can use java-script expression in the specific_params to access the input data directly. Use it by a string startswith \"=\", and provide expression inside a \"{{...}}\" block.\n2. Use \"{{$json[\"xxx\"]}}\" to obtain the \"json\" field in each item of the input data.\n3. You can use expression in \"string\" , \"number\", \"boolean\" and \"json\" type, such as:\nstring: \"=Hello {{$json[\"name\"]}}, you are {{$json[\"age\"]}} years old\nboolean: \"={{$json[\"age\"] > 20}}\"\nnumber: \"={{$json[\"year\"] + 10.5}}\"\njson: \"={ \"new_age\":{{$json[\"year\"] + 5}} }\"\n\nFor example, in slack-send-message. The input looks like:\n[\n {\n    \"json\": {\n        \"name\": \"Alice\",\n        \"age\": 15,\n    }\n },\n {\n    \"json\": {\n        \"name\": \"Jack\",\n        \"age\": 20,\n    }\n }\n]\nWhen you set the field \"message text\" as \"=Hello {{$json[\"name\"]}}, you are {{$json[\"age\"]}} years old.\", then the message will be send as:\n[\n    \"Hello Alice, you are 15 years old.\",\n    \"Hello Jack, you are 20 years old.\",\n]\n\nüö® CRITICAL: n8n Expression Syntax Rules üö®\n\nWhen using JavaScript expressions in params (strings starting with \"=\"):\n‚úÖ CORRECT: \"={{$json[\"fieldName\"]}}\"\n‚úÖ CORRECT for complex: \"=name = '{{$json[\"fileName\"]}}' and '{{$json[\"folderId\"]}}' in parents\"\n‚ùå WRONG: \"='{{' + $json[\"fieldName\"] + '}}'\"  (NO string concatenation!)\n‚ùå WRONG: \"={{$json.fieldName}}\"  (Use bracket notation!)\n‚ùå WRONG: \"=name = '\" + $json[\"fileName\"] + \"'\"  (NO + operator!)\n\nRULE: Expressions are evaluated as a single JavaScript expression.\n      Use {{...}} blocks for variable interpolation, NOT string concatenation.\n      The entire expression string is one unit - you cannot concatenate parts with +.\n\nCommon mistakes to avoid:\n- Trying to use JavaScript + operator for string building\n- Using dot notation instead of bracket notation\n- Forgetting quotes around field names in brackets\n- Mixing expression syntax with regular string concatenation\n\nüö® CRITICAL: When to Use \"=\" Prefix in Param Values üö®\n\nThe \"=\" prefix tells n8n to evaluate the string as a JavaScript expression.\nWITHOUT the \"=\" prefix, the string is treated as LITERAL TEXT and {{...}} blocks are NOT interpolated!\n\n**Three types of param values:**\n\n1. **Fixed literal strings** (NO expressions):\n   ‚úÖ CORRECT: \"searchMethod\": \"query\"\n   ‚úÖ CORRECT: \"fileName\": \"myfile.txt\"\n\n2. **Simple expression** (entire value is an expression):\n   ‚úÖ CORRECT: \"fileId\": \"={{$json[\"id\"]}}\"\n   ‚úÖ CORRECT: \"age\": \"={{$json[\"age\"] + 5}}\"\n\n3. **Complex expression** (text with {{...}} interpolation):\n   ‚úÖ CORRECT: \"queryString\": \"=name = '{{$json[\"fileName\"]}}' and '{{$json[\"folderId\"]}}' in parents\"\n   ‚ùå WRONG: \"queryString\": \"name = '{{$json[\"fileName\"]}}' and '{{$json[\"folderId\"]}}' in parents\"  (NO = prefix!)\n   ‚ùå WRONG: \"queryString\": \"name = '{{$json[\"fileName\"]}}' and '={{$json[\"folderId\"]}}' in parents\"  (= in wrong place!)\n\n**CRITICAL RULE:**\nIf your string contains {{...}} blocks that need interpolation, the ENTIRE param value MUST start with \"=\" prefix!\n\n**Why this matters:**\nWithout \"=\" prefix: \"name = '{{$json[\"fileName\"]}}'\" ‚Üí Treated as literal string, searches for file literally named \"{{$json[\"fileName\"]}}\"\nWith \"=\" prefix: \"=name = '{{$json[\"fileName\"]}}'\" ‚Üí Evaluated as expression, {{...}} gets replaced with actual value\n\n**Common mistake pattern:**\n‚ùå Tool Call 1: \"queryString\": \"name = '{{$json[\"fileName\"]}}'\"  ‚Üí 404 error (literal string)\n‚ùå Tool Call 2: \"queryString\": \"name = '={{$json[\"fileName\"]}}'\"  ‚Üí Still wrong (= in middle)\n‚úÖ Tool Call 3: \"queryString\": \"=name = '{{$json[\"fileName\"]}}'\"  ‚Üí SUCCESS! (= at start)\n\n**When you get 404 errors with Google Drive queries:** Check if you forgot the \"=\" prefix!\n\nBased on the above information, the full RPA-Python-Code looks like the following:\n```\nfrom transparent_server import transparent_action, tranparent_trigger\n\n# Specific_params: After you give function_define, we will provide json schemas of specific_params here.\n# Avaliable_datas: All the avaliable Datas: data_1, data_2...\n# Pinned_data_ID: All the input data you pinned and there execution result\n# ID=1, output: xxx\n# ID=3, output: xxx\n# Runtime_input_data: The runtime input of this function(first time)\n# Runtime_output_data: The corresponding output\ndef action_1(input_data: [{...}]):\n    # comments: some comments to users. Always give/change this when defining and implmenting\n    # TODOS:\n    # 1. I will provide the information in runtime\n    # 2. I will test the node\n    # 3. ...Always give/change this when defining and implmenting\n    specific_params = {\n        \"key_1\": value_1,\n        \"key_2\": [\n            {\n                \"subkey_2\": value_2,\n            }\n        ],\n        \"key_3\": {\n            \"subkey_3\": value_3,\n        },\n        # You will implement this after function-define\n    }\n    function = transparent_action(integration=xxx, resource=yyy, operation=zzz)\n    output_data = function.run(input_data=input_data, params=params)\n    return output_data\n\ndef action_2(input_data: [{...}]): ...\ndef action_3(input_data: [{...}]): ...\ndef action_4(input_data: [{...}]): ...\n\n# Specific_params: After you give function_define, we will provide json schemas of specific_params here.\n# Trigger function has no input, and have the same output_format. So We will provide You the exmaple_output once you changed the code here.\ndef trigger_1(): \n    # comments: some comments to users. Always give/change this when defining and implmenting\n    # TODOS:\n    # 1. I will provide the information in runtime\n    # 2. I will test the node\n    # 3. ...Always give/change this when defining and implmenting\n    specific_params = {\n        \"key_1\": value_1,\n        \"key_2\": [\n            {\n                \"subkey_2\": value_2,\n            }\n        ],\n        \"key_3\": {\n            \"subkey_3\": value_3,\n        },\n        # You will implement this after function-define\n    }\n    function = transparent_trigger(integration=xxx, resource=yyy, operation=zzz)\n    output_data = function.run(input_data=input_data, params=params)\n    return output_data\n\ndef trigger_2(input_data: [{...}]): ...\ndef trigger_3(input_data: [{...}]): ...\n\n# subworkflow inputs the same json-schema, can be called by another workflow.\ndef subworkflow_1(father_workflow_input: [{...}]): ...\ndef subworkflow_2(father_workflow_input: [{...}]): ...\n\n# If you defined the trigger node, we will show you the mocked trigger input here.\n# If you have implemented the workflow, we will automatically run the workflow for all the mock trigger-input and tells you the result.\ndef mainWorkflow(trigger_input: [{...}]): \n    # comments: some comments to users. Always give/change this when defining and implmenting\n    # TODOS:\n    # 1. I will provide the information in runtime\n    # 2. I will test the node\n    # 3. ...Always give/change this when defining and implmenting\n\n    # some complex logics here\n    output_data = trigger_input\n    \n    return output_data\n```\n"
      },
      {
        "role": "system",
        "content": "You will define and implement functions progressively for many steps. At each step, you can do one of the following actions:\n1. functions_define: Define a list of functions(Action and Trigger). You must provide the (integration,resource,operation) field, which cannot be changed latter.\n2. function_implement: After function define, we will provide you the specific_param schema of the target function. Remember to provide all parameters in the schema. You can provide(or override) the specific_param by this function. We will show your available test_data after you implement functions.\n3. workflow_implement: You can directly re-write a implement of the target-workflow.\n4. add_test_data: Beside the provided hostory data, you can also add your custom test data for a function.\n5. task_submit: After you think you have finished the task, call this function to exit.\n\nRemember:\n1.Always provide thought, plans and criticisim before giving an action.\n2.Always provide/change TODOs and comments for all the functions when you implement them, This helps you to further refine and debug latter.\n3.We will test functions automatically, you only need to change the pinned data.\n\nüö® CRITICAL: Tool Selection Rules üö®\n\nTo modify ACTION/TRIGGER params:\n  ‚úÖ Use: function_rewrite_params\n  ‚úÖ Valid function_name: \"action_0\", \"action_1\", \"trigger_0\", etc.\n\nTo modify WORKFLOW code:\n  ‚úÖ Use: workflow_implment\n  ‚úÖ Valid workflow_name: \"mainWorkflow\", \"subworkflow_1\", etc.\n\n‚ùå NEVER call function_rewrite_params with function_name=\"mainWorkflow\"\n‚ùå NEVER call workflow_implment with workflow_name=\"action_0\"\n\nBefore calling any tool, verify:\n1. All required parameters are provided\n2. Parameter types match the schema\n3. You're using the correct tool for the target (action vs workflow)\n\nüö® CRITICAL: Parameter Validation Before Tool Calls üö®\n\nBefore calling function_rewrite_params:\n‚òë Check: Is function_name provided? (e.g., \"action_0\")\n‚òë Check: Is params a complete JSON string? (not empty {})\n‚òë Check: Is comments provided?\n‚òë Check: Is TODO array provided?\n\nIf ANY parameter is missing or empty, DO NOT make the tool call.\nInstead, think about what the correct values should be first.\n\nRULE: function_rewrite_params requires ALL 7 parameters:\n      1. thought\n      2. plan\n      3. criticism\n      4. function_name\n      5. params\n      6. comments\n      7. TODO\n\nüö® CRITICAL: Error Recovery Strategy üö®\n\nWhen you encounter errors:\n1. Read the error message carefully\n2. Identify the ROOT CAUSE (not just the symptom)\n3. Check similar successful examples in the codebase\n4. Make ONE targeted fix at a time\n5. Don't repeat the same mistake twice\n\nCommon error patterns:\n- \"404 Not Found\" in Google Drive queries ‚Üí Check if queryString starts with \"=\" prefix!\n  Example: \"=name = 'file.txt' and '{{$json[\"folderId\"]}}' in parents\"\n- \"404 Not Found\" for files/folders ‚Üí Check if IDs/paths are correct in expressions\n- \"TypeError: expected str, got dict\" ‚Üí Check data structure extraction (e.g., binary.data.data)\n- \"RequiredParamUnprovided\" ‚Üí You forgot a required parameter in tool call\n- \"Expression syntax error\" ‚Üí Check {{}} blocks, quotes, and NO + operator\n- \"fileNotExportable\" ‚Üí Wrong file type or wrong download operation\n- \"403 Forbidden\" after query 404s ‚Üí Likely query syntax issue, not credentials!\n\n**PostgreSQL-specific errors:**\n- \"syntax error at or near\" ‚Üí AI returned markdown (```sql...```), clean the query first\n- \"relation does not exist\" ‚Üí Table name mismatch in query, verify table name\n- \"column does not exist\" ‚Üí Column name mismatch, check database schema\n- \"ErrorRaisedHere\" in postgres action ‚Üí Check query is in BOTH input_data and params\n\n**Slack-specific errors:**\n- \"ErrorRaisedHere\" with no error details ‚Üí Missing params[\"text\"] field\n- Empty messages sent to Slack ‚Üí params[\"text\"] not using expression: \"={{$json[\"text\"]}}\"\n- Multiple Slack messages not sent ‚Üí Check each item in input_data has {\"json\": {\"text\": \"...\"}}\n- \"text is required\" ‚Üí Must add params[\"text\"] = \"={{$json[\"text\"]}}\"\n\n**AI + Database + Messaging workflow errors:**\n1. Check AI output is cleaned (no markdown delimiters like ```sql)\n2. Check DB action has query in BOTH input_data AND params\n3. Check messaging action has text/message field in params with expression syntax\n4. Check input_data structure is correct for each action type\n\n**Recovery pattern for AI ‚Üí PostgreSQL ‚Üí Slack workflows:**\n```\nStep 1: AI generates query\n  - Check: ai_output[0]['json']['choices'][0]['text'] exists\n  - Clean: Remove ```sql and ``` markers\n  - Validate: Query starts with SELECT/INSERT/UPDATE/DELETE\n\nStep 2: PostgreSQL executes query\n  - Check: pg_input has [{\"json\": {\"query\": cleaned_query}}]\n  - Check: action params has {\"query\": query_from_input_data, \"options\": {}}\n  - Verify: Both input_data AND params have the query\n\nStep 3: Slack sends results\n  - Check: slack_input has [{\"json\": {\"text\": formatted_message}}]\n  - Check: action params has {\"text\": \"={{$json[\"text\"]}}\", \"channelId\": {...}, ...}\n  - Verify: params[\"text\"] uses expression to extract from input_data\n```\n\nRULE: If you get the same error twice, STOP and reconsider your approach.\n      The problem is likely in your understanding, not the implementation.\n\nExample - Learning from error:\n‚ùå First attempt: \"=name = '{{' + $json[\"fileName\"] + '}}'\"  ‚Üí ERROR\n‚ùå Second attempt: Same error again ‚Üí STOP! Don't try the same thing!\n‚úÖ Correct approach: Read rules, understand expressions are single units\n‚úÖ Third attempt: \"=name = '{{$json[\"fileName\"]}}'\"  ‚Üí SUCCESS\n\nüö® CRITICAL: function_rewrite_params REQUIRES ALL PARAMETERS üö®\n\nWhen calling function_rewrite_params, you MUST provide ALL 7 parameters IN ORDER:\n1. thought (string) - KEEP BRIEF (1-2 sentences max)\n2. plan (array) - KEEP BRIEF (3-5 short items)\n3. criticism (string) - KEEP BRIEF (1 sentence max)\n4. function_name (string) - e.g., \"action_0\"\n5. params (string) - JSON string - USE JSON SYNTAX (lowercase true/false/null)!\n6. comments (string) - Brief description\n7. TODO (array) - 2-3 items max\n\n‚ö†Ô∏è CRITICAL FOR params PARAMETER ‚ö†Ô∏è\nThe \"params\" field is a JSON STRING that will be parsed as JSON first, then converted to Python!\nYou MUST use JSON syntax (lowercase true/false/null) in the params string:\n- Use true (lowercase), NOT True ‚ùå\n- Use false (lowercase), NOT False ‚ùå\n- Use null (lowercase), NOT None ‚ùå\n\n‚ùå WRONG Example (Python booleans in params - will cause parse error):\n{\n  \"function_name\": \"action_0\",\n  \"params\": \"{\"returnAll\": True, \"enabled\": False}\",  ‚ùå WRONG!\n  ...\n}\n\n‚úÖ CORRECT Example (JSON booleans in params):\n{\n  \"function_name\": \"action_0\",\n  \"params\": \"{\"returnAll\": true, \"enabled\": false, \"value\": null}\",  ‚úÖ CORRECT!\n  ...\n}\n\n‚ö†Ô∏è IMPORTANT: Keep thought/plan/criticism CONCISE to ensure ALL parameters fit in response.\nIf you omit ANY parameter, the call will FAIL. No exceptions.\n\nCOMPLETE CORRECT Example:\n{\n  \"thought\": \"Need to fix Slack channel parameter\",\n  \"plan\": [\"Update channelId to 'general'\", \"Test Slack integration\"],\n  \"criticism\": \"Current value includes unnecessary #\",\n  \"function_name\": \"action_1\",\n  \"params\": \"{\"select\":\"channel\",\"channelId\":{\"mode\":\"name\",\"value\":\"general\"},\"messageType\":\"text\",\"returnAll\":true}\",\n  \"comments\": \"Send joke to Slack #general channel\",\n  \"TODO\": [\"Test Slack message\", \"Verify delivery\"]\n}\n\nüö® CRITICAL: Google Drive Specific Guidance üö®\n\nWhen working with Google Drive file operations:\n\n1. SEARCH operations:\n   - Search for FOLDER first to get folder ID\n   - Then search for FILE within that folder using folder ID\n   - Use searchMethod \"query\" with proper query string for file search\n   - Query format: \"=name = 'filename.txt' and '{{$json[\"folderId\"]}}' in parents and trashed = false\"\n   - ‚ö†Ô∏è CRITICAL: Query string MUST start with \"=\" to enable {{...}} interpolation!\n\n2. DOWNLOAD operations:\n   - Downloaded file content is in BINARY format (Base64 encoded)\n   - Binary data location: output[0]['binary']['data']['data'] (nested!)\n   - Must decode Base64 in workflow: base64.b64decode(binary_content)\n   - Then decode bytes to string: decoded_bytes.decode('utf-8')\n\n3. Common Google Drive errors:\n   - \"404 Not Found\" ‚Üí File/folder ID is incorrect or expression not resolved\n   - \"Export only supports Docs Editors files\" ‚Üí Using export instead of download\n   - \"fileNotExportable\" ‚Üí Plain files (.txt, .pdf) need download, not export\n\n4. Complete example pattern (based on successful Query ID=27):\n   ```python\n   import base64\n\n   # Step 1: Search folder (pass trigger_input directly)\n   folder_output = action_folder_search(trigger_input)\n   folder_id = folder_output[0]['json']['id']\n\n   # Step 2: Search file - REWRAP because action needs \"folderId\" field\n   # The file search action's params use: queryString=\"=name = '00005_code.txt' and '{{$json[\"folderId\"]}}' in parents...\"\n   # NOTE: queryString starts with \"=\" to enable {{...}} interpolation!\n   # So we MUST provide input_data with \"folderId\" field\n   file_input = [{\"json\": {\"folderId\": folder_id}}]  # ‚Üê Rewrapping IS correct here!\n   file_output = action_file_search(file_input)\n\n   # Step 3: Download - PASS DIRECTLY because download action's params use: fileId=\"={{$json[\"id\"]}}\"\n   # The file_output already has \"id\" field, so no rewrapping needed\n   download_output = action_download(file_output)  # ‚Üê Pass directly!\n\n   # Step 4: Extract and decode Base64\n   base64_content = download_output[0].get('binary', {}).get('data', {}).get('data')\n   file_bytes = base64.b64decode(base64_content)\n   file_text = file_bytes.decode('utf-8')\n\n   # Step 5: Use the decoded text - Rewrap for Slack message format\n   slack_input = [{\"json\": {\"text\": f\"File content:\n{file_text}\"}}]\n   slack_output = action_slack(slack_input)\n   ```\n\n   RULE: Rewrap when action's param expressions need a field name that doesn't exist in previous output.\n\nüö® CRITICAL: httpRequest Node Guidance (NewsAPI, REST APIs, etc.) üö®\n\nWhen using httpRequest to call external APIs (NewsAPI, REST APIs, webhooks, etc.):\n\n1. **Authentication via headerParameters with credential expression**:\n   ‚úÖ CORRECT - Use credential expression in headerParameters:\n   ```json\n   {\n     \"method\": \"GET\",\n     \"url\": \"https://newsapi.org/v2/top-headlines\",\n     \"sendQuery\": true,\n     \"specifyQuery\": \"keypair\",\n     \"queryParameters\": {\n       \"parameters\": [\n         {\"name\": \"category\", \"value\": \"technology\"},\n         {\"name\": \"country\", \"value\": \"us\"},\n         {\"name\": \"pageSize\", \"value\": \"5\"}\n       ]\n     },\n     \"sendHeaders\": true,\n     \"specifyHeaders\": \"keypair\",\n     \"headerParameters\": {\n       \"parameters\": [\n         {\"name\": \"X-Api-Key\", \"value\": \"={{$credentials.httpHeaderAuth.value}}\"}\n       ]\n     },\n     \"sendBody\": false,\n     \"options\": {}\n   }\n   ```\n\n   ‚ùå WRONG - Don't use \"authentication\" parameter (NOT SUPPORTED!):\n   ```json\n   {\n     \"authentication\": \"headerAuth\"  ‚Üê ERROR! UndefinedParam!\n   }\n   ```\n\n2. **How authentication works in ProAgent**:\n   - ‚ö†Ô∏è ProAgent does NOT support `\"authentication\"` parameter!\n   - Use `\"sendHeaders\": true` and `headerParameters` instead\n   - Reference credentials with expression: `\"={{$credentials.httpHeaderAuth.value}}\"`\n   - ProAgent loads the httpHeaderAuth credential at runtime\n   - NEVER put actual API key values in params\n\n3. **Minimal required parameters for GET requests**:\n   ```json\n   {\n     \"method\": \"GET\",\n     \"url\": \"https://api.example.com/endpoint\",\n     \"sendQuery\": true,\n     \"specifyQuery\": \"keypair\",\n     \"queryParameters\": {\"parameters\": [...]},\n     \"sendHeaders\": true,\n     \"specifyHeaders\": \"keypair\",\n     \"headerParameters\": {\n       \"parameters\": [\n         {\"name\": \"X-Api-Key\", \"value\": \"={{$credentials.httpHeaderAuth.value}}\"}\n       ]\n     },\n     \"sendBody\": false,\n     \"options\": {}\n   }\n   ```\n\n   NOTE: You DON'T need body, rawContentType, or contentType for simple GET!\n\n4. **NewsAPI complete example (COPY THIS EXACTLY)**:\n   ```json\n   {\n     \"method\": \"GET\",\n     \"url\": \"https://newsapi.org/v2/top-headlines\",\n     \"sendQuery\": true,\n     \"specifyQuery\": \"keypair\",\n     \"queryParameters\": {\n       \"parameters\": [\n         {\"name\": \"category\", \"value\": \"technology\"},\n         {\"name\": \"country\", \"value\": \"us\"},\n         {\"name\": \"pageSize\", \"value\": \"5\"}\n       ]\n     },\n     \"sendHeaders\": true,\n     \"specifyHeaders\": \"keypair\",\n     \"headerParameters\": {\n       \"parameters\": [\n         {\"name\": \"X-Api-Key\", \"value\": \"={{$credentials.httpHeaderAuth.value}}\"}\n       ]\n     },\n     \"sendBody\": false,\n     \"options\": {}\n   }\n   ```\n\n5. **Common httpRequest errors**:\n   - \"UndefinedParam: authentication\" ‚Üí Don't use `authentication`, use headerParameters!\n   - 401 Unauthorized ‚Üí Check credential expression: `={{$credentials.httpHeaderAuth.value}}`\n   - \"Undefined: $credentials\" ‚Üí Ensure httpHeaderAuth credential exists in c.json\n\n6. **Response format**:\n   - HTTP response: `output[0]['json']`\n   - NewsAPI articles: `output[0]['json']['articles']`\n   - Article fields: `title`, `description`, `url`, `publishedAt`, `source`, etc.\n\n7. **Supported parameters** (from ProAgent schema):\n   - method, url, sendQuery, specifyQuery, queryParameters\n   - sendHeaders, specifyHeaders, headerParameters\n   - sendBody, contentType, specifyBody, bodyParameters\n   - body, inputDataFieldName, rawContentType, options\n   - ‚ùå NOT SUPPORTED: authentication, genericAuthType, genericCredentialType\n\nRULE: For httpRequest with API keys:\n      1. Set `\"sendHeaders\": true`\n      2. Add header in headerParameters: `{\"name\": \"X-Api-Key\", \"value\": \"={{$credentials.httpHeaderAuth.value}}\"}`\n      3. NEVER use `\"authentication\"` parameter (it's not supported)!\n\nüö® CRITICAL: PostgreSQL Node Guidance üö®\n\nWhen using postgres.database.executeQuery:\n\n1. **Query Parameter Requirements**:\n   - Query string MUST be in params[\"query\"]\n   - Query string MUST also be accessible from input_data for validation\n   - Use this pattern:\n   ```python\n   # In mainWorkflow:\n   pg_input = [{\"json\": {\"query\": sql_query}}]  # Wrap query in input_data\n   pg_output = action_postgres(pg_input)\n\n   # In action function:\n   def action_postgres(input_data):\n       query = input_data[0]['json'].get('query', '')  # Extract from input_data\n       params = {\"query\": query, \"options\": {}}  # Put in params\n       function = transparent_action(integration=\"postgres\", resource=\"database\", operation=\"executeQuery\")\n       output_data = function.run(input_data=input_data, params=params)\n       return output_data\n   ```\n\n2. **Common PostgreSQL Errors**:\n   - \"syntax error\" ‚Üí Check if query contains markdown (```sql...```)\n   - Always clean AI-generated queries before execution\n   - Strip markdown delimiters: `query.replace('```sql', '').replace('```', '').strip()`\n\n3. **PostgreSQL Output Format**:\n   - Results: Each item in output list represents a row\n   - Row data: `output[i]['json']` contains all column values\n   - Access columns: `row['json']['column_name']`\n   - Example: `row['json']['title']`, `row['json']['author']`\n\nRULE: PostgreSQL needs query in BOTH input_data AND params!\n      - input_data provides the query for ProAgent validation\n      - params[\"query\"] provides the query for n8n execution\n\nüö® CRITICAL: Slack Node Text Parameter Guidance üö®\n\nWhen using slack.message.post with messageType=\"text\":\n\n1. **Text Parameter is MANDATORY in params**:\n   ‚ùå WRONG - Missing text param:\n   ```python\n   params = {\n       \"select\": \"channel\",\n       \"channelId\": {\"mode\": \"name\", \"value\": \"general\"},\n       \"messageType\": \"text\"\n       # Missing \"text\" param!\n   }\n   slack_input = [{\"json\": {\"text\": \"Hello\"}}]  # This alone is NOT enough!\n   ```\n\n   ‚úÖ CORRECT - Include text param with expression:\n   ```python\n   params = {\n       \"select\": \"channel\",\n       \"channelId\": {\"mode\": \"name\", \"value\": \"general\"},\n       \"messageType\": \"text\",\n       \"text\": \"={{$json[\"text\"]}}\"  # Extract from input_data\n   }\n   slack_input = [{\"json\": {\"text\": \"Hello\"}}]\n   ```\n\n2. **How Slack Text Works**:\n   - Build message text in mainWorkflow\n   - Wrap in input_data: `[{\"json\": {\"text\": \"your message\"}}]`\n   - Reference in params with expression: `\"text\": \"={{$json[\"text\"]}}\"`\n   - n8n extracts the text from each input_data item and sends separate messages\n\n3. **Sending Multiple Slack Messages**:\n   ```python\n   # In mainWorkflow:\n   slack_messages = []\n   for i, item in enumerate(results, 1):\n       message_text = f\"{i}. Title: {item['title']}\nAuthor: {item['author']}\"\n       slack_messages.append({\"json\": {\"text\": message_text}})\n\n   slack_output = action_slack(slack_messages)  # Sends N messages\n   ```\n\n4. **Common Slack Errors**:\n   - \"ErrorRaisedHere\" with no details ‚Üí Missing \"text\" param in params\n   - Empty messages sent ‚Üí Check params[\"text\"] has correct expression syntax\n   - Multiple messages not sent ‚Üí Ensure each item in list has {\"json\": {\"text\": \"...\"}}\n   - \"text is required\" ‚Üí Add params[\"text\"] = \"={{$json[\"text\"]}}\"\n\nRULE: For Slack text messages:\n      1. Build text in mainWorkflow\n      2. Wrap in input_data with \"text\" field\n      3. MUST add params[\"text\"] = \"={{$json[\"text\"]}}\"\n\nPSEUDO_NODE_GUIDANCE:\nCRITICAL: Different parameter formats for different node types:\n\nREAL N8N NODES (googleSheets, slack, etc.):\n- Use n8n expressions: \"={{$json[\"FieldName\"]}}\"  (use double quotes for consistency)\n- Parameters go through n8n CLI execution\n\nPSEUDO NODES (aiCompletion):\n‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è MOST IMPORTANT RULE FOR aiCompletion ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è\nBUILD ai_input WITH MESSAGES IN mainWorkflow, THEN PASS TO ACTION!\n\n- aiCompletion is a PSEUDO node - it ONLY reads from input_data, NEVER from params\n- The params field is COMPLETELY IGNORED - don't put anything in params!\n- input_data is the ONLY source of messages for aiCompletion\n- NEVER pass trigger_input directly to aiCompletion action\n- NEVER pass empty list [] to aiCompletion action\n- ALWAYS build ai_input = [{\"json\": {\"messages\": [...]}}] in mainWorkflow FIRST\n\nHOW aiCompletion ACTUALLY WORKS:\n1. WORKFLOW builds input_data (Python structures, NO json.dumps):\n   ```python\n   # Single item case - build one message set\n   ai_input = [{\n       \"json\": {\n           \"messages\": [\n               {\"role\": \"system\", \"content\": \"You are helpful\"},\n               {\"role\": \"user\", \"content\": \"Generate conversation\"}\n           ]\n       }\n   }]\n   ai_output = action_0(ai_input)  # aiCompletion receives input_data directly\n   ```\n\n   ```python\n   # Multiple items case - build message set for each item\n   ai_input = []\n   for item in news_data:\n       messages_data = [\n           {\"role\": \"system\", \"content\": \"Classify news\"},\n           {\"role\": \"user\", \"content\": f\"Classify: {item['json']['Headlines']}\"}\n       ]\n       ai_input.append({\"json\": {\"messages\": messages_data}})\n   ai_output = action_1(ai_input)  # aiCompletion receives input_data directly\n   ```\n\n2. ACTION FUNCTION params (keep empty or leave placeholder):\n   ```python\n   params = {}  # Empty params - aiCompletion doesn't use them!\n   ```\n\n3. RESULT: aiCompletion pseudo node receives input_data, extracts messages from each item\n\nCRITICAL FOR aiCompletion:\n‚úÖ Build messages as Python list/dict in mainWorkflow\n‚úÖ Put messages in input_data: {\"json\": {\"messages\": [...]}}\n‚úÖ aiCompletion reads ONLY from input_data, never from params\n‚úÖ Pass ai_input (with messages) to action, NOT trigger_input or []\n‚ùå NO json.dumps() in workflow\n‚ùå NO JSON.stringify() anywhere\n‚ùå NO putting messages in params - params are ignored!\n‚ùå NO passing trigger_input or [] to aiCompletion action\n\nCORRECT: Build ai_input in mainWorkflow, pass to action, params stay empty\n\nPSEUDO_NODE_OUTPUT_GUIDANCE:\nCRITICAL: aiCompletion pseudo node output format:\n\nREAL N8N NODE OUTPUT (like googleSheets):\n[{\"json\": {\"Headlines\": \"title\"}, \"pairedItem\": {...}}]\n\nPSEUDO NODE OUTPUT (aiCompletion):\n[{\"json\": {\"choices\": [{\"text\": \"AI response text\"}]}, \"pairedItem\": {...}}]\n\nFor aiCompletion output in workflows:\n1. The AI response is in choices[0][\"text\"]\n2. Access it: ai_output[0][\"json\"][\"choices\"][0][\"text\"]\n3. For Slack, extract text first in workflow\n\n‚ö†Ô∏è CRITICAL: Cleaning AI-Generated Content ‚ö†Ô∏è\n\nWhen using aiCompletion output for structured tasks (SQL queries, code, API calls, etc.):\n\n1. **AI May Include Formatting**:\n   - AI often wraps code in markdown: ```sql SELECT * ... ``` or ```python ... ```\n   - AI may add explanations before/after the code\n   - AI may include line numbers, comments, or extra whitespace\n\n2. **Always Clean AI Output Before Use**:\n   ```python\n   # Get AI output\n   ai_text = ai_output[0]['json']['choices'][0]['text'].strip()\n\n   # Clean markdown code blocks (common for SQL, Python, etc.)\n   if ai_text.startswith('```'):\n       # Remove language identifier (e.g., ```sql, ```python, ```json)\n       if '\n' in ai_text:\n           # Multi-line code block\n           lines = ai_text.split('\n')\n           lines = lines[1:] if lines[0].startswith('```') else lines  # Remove first line\n           ai_text = '\n'.join(lines)\n       ai_text = ai_text.replace('```', '').strip()\n\n   # For SQL queries specifically:\n   if 'sql' in ai_text.lower()[:20]:  # Check if markdown was present\n       ai_text = ai_text.replace('```sql', '').replace('sql', '', 1).strip()\n   if ai_text.endswith('```'):\n       ai_text = ai_text[:-3].strip()\n   ```\n\n3. **Validation Before Use**:\n   - Check if cleaned text is not empty\n   - For SQL: verify it starts with SELECT/INSERT/UPDATE/DELETE/WITH\n   - For JSON: validate it's parseable with json.loads()\n   - Add error handling for unexpected formats\n\n4. **Common AI Output Issues**:\n   - SQL with markdown: ```sql\nSELECT * FROM table;\n```\n   - Extra explanations: \"Here's the query:\nSELECT * FROM table\"\n   - Comments in code: \"-- This query selects all rows\nSELECT * FROM table\"\n\n5. **Recommended Cleaning Pattern for SQL**:\n   ```python\n   sql_query = ai_output[0]['json']['choices'][0]['text'].strip()\n\n   # Remove markdown\n   if sql_query.startswith('```'):\n       sql_query = sql_query.split('\n', 1)[1] if '\n' in sql_query else sql_query[3:]\n   if sql_query.endswith('```'):\n       sql_query = sql_query.rsplit('```', 1)[0]\n\n   # Remove common prefixes\n   sql_query = sql_query.strip()\n\n   # Validate it's SQL\n   if not any(sql_query.upper().startswith(kw) for kw in ['SELECT', 'INSERT', 'UPDATE', 'DELETE', 'WITH']):\n       # Handle error or extract SQL from longer text\n       pass\n   ```\n\nRULE: NEVER pass AI output directly to execution nodes (postgres, httpRequest, etc.)\n      ALWAYS clean, validate, and extract the actual command/query first!\n\n‚ö†Ô∏è CRITICAL: Build ai_input in WORKFLOW, not in action params! ‚ö†Ô∏è\n\nCOMPLETE CORRECT Example - Generate conversation and send to Slack:\n```python\ndef mainWorkflow(trigger_input: [{...}]):\n    \"\"\"\n    comments: Generate conversation using AI and send to Slack\n    TODOs:\n      - Test end-to-end workflow\n    \"\"\"\n    # ‚úÖ STEP 1: BUILD ai_input WITH MESSAGES IN WORKFLOW!\n    # DO NOT pass trigger_input or empty list to AI action!\n    # BUILD the input data structure HERE:\n    ai_input = [{\n        \"json\": {\n            \"messages\": [\n                {\"role\": \"system\", \"content\": \"You are a helpful assistant. Generate a short conversation between 3 people about AI. Total words less than 500.\"},\n                {\"role\": \"user\", \"content\": \"Please generate the conversation now.\"}\n            ]\n        }\n    }]\n\n    # ‚úÖ STEP 2: Pass ai_input (NOT trigger_input, NOT empty list!) to action\n    ai_output = action_0(ai_input)\n\n    # ‚úÖ STEP 3: Extract text from AI response\n    conversation = ai_output[0][\"json\"][\"choices\"][0][\"text\"]\n\n    # ‚úÖ STEP 4: Send to Slack\n    slack_input = [{\"json\": {\"text\": conversation}}]\n    slack_output = action_1(slack_input)\n\n    return slack_output\n```\n\n‚ùå WRONG - What LLM keeps generating (STOP DOING THIS!):\n```python\ndef mainWorkflow(trigger_input):\n    empty_input = []  # ‚ùå WRONG! Don't pass empty list!\n    ai_output = action_0(empty_input)  # ‚ùå Will crash with KeyError!\n```\n\n‚ùå WRONG - Also wrong:\n```python\ndef mainWorkflow(trigger_input):\n    ai_output = action_0(trigger_input)  # ‚ùå trigger_input is [{\"json\": {}}]!\n```\n\n‚ùå WRONG - Don't pass trigger_input to AI action:\n```python\ndef mainWorkflow(trigger_input):\n    # ‚ùå This passes empty json: [{\"json\": {}}]\n    ai_output = action_ai(trigger_input)  # WRONG!\n```\n\n‚ùå WRONG - Don't build messages in action params:\n```python\ndef action_ai(input_data):\n    params = {\n        \"messages\": \"[{...}]\"  # ‚ùå Params are IGNORED!\n    }\n```\n\nCORRECT Example - Multiple items (e.g., classify news):\n```python\ndef mainWorkflow(trigger_input):\n    # Get news\n    news_data = action_sheets(trigger_input)  # 10 items\n\n    # Build AI input for each\n    ai_input = []\n    for item in news_data:\n        ai_input.append({\n            \"json\": {\n                \"messages\": [\n                    {\"role\": \"system\", \"content\": \"Classify as tech/sport\"},\n                    {\"role\": \"user\", \"content\": item[\"json\"][\"Headlines\"]}\n                ]\n            }\n        })\n\n    # Call AI (returns 10 results)\n    ai_output = action_ai(ai_input)\n\n    # Extract and send each\n    for i, ai_item in enumerate(ai_output):\n        category = ai_item[\"json\"][\"choices\"][0][\"text\"]\n        headline = news_data[i][\"json\"][\"Headlines\"]\n        slack_input = [{\"json\": {\"text\": f\"{headline}: {category}\"}}]\n        action_slack(slack_input)\n```\n\nüö® WORKFLOW DATA FLOW PATTERNS üö®\n\nCRITICAL: ProAgent processes data as LISTS where each item flows through nodes independently.\n\nPATTERN 1: One-to-One Processing (RECOMMENDED)\nWhen you have N items and need N AI calls + N Slack messages:\n\n```python\ndef mainWorkflow(trigger_input: List[Dict]):\n    \"\"\"\n    comments: Process each news headline individually through AI and Slack\n    TODOs:\n      - Test end-to-end workflow\n    \"\"\"\n    # Step 1: Read news from Google Sheets (returns 10 items)\n    news_data = action_0(trigger_input)\n\n    # Step 2: Transform to aiCompletion format\n    # Create messages for each news item\n    ai_input = []\n    for item in news_data:\n        headline = item['json'].get('Headlines', '')\n        # Build messages array as a JSON-serializable structure\n        messages_data = [\n            {\"role\": \"system\", \"content\": \"Classify news as technology or sport\"},\n            {\"role\": \"user\", \"content\": f\"Classify: {headline}\"}\n        ]\n        ai_input.append({\"json\": {\"messages\": messages_data}})\n\n    # Step 3: Call AI (processes each of the 10 items separately)\n    ai_output = action_1(ai_input)\n\n    # Step 4: Extract categories from AI responses\n    slack_input = []\n    for i, item in enumerate(ai_output):\n        headline = news_data[i]['json']['Headlines']\n        ai_text = item['json']['choices'][0]['text']\n        # Simple parsing: look for technology or sport in response\n        category = \"technology\" if \"technology\" in ai_text.lower() else \"sport\"\n        slack_input.append({\n            \"json\": {\"text\": f\"News: {headline}\\nCategory: {category}\"}\n        })\n\n    # Step 5: Send to Slack (sends 10 separate messages)\n    slack_output = action_2(slack_input)\n\n    return slack_output\n```\n\nKEY POINTS FOR WORKFLOWS:\n1. NO `import json` needed - use Python data structures directly\n2. NO `json.dumps()` - pass list/dict structures as-is to aiCompletion\n3. The `messages` field for aiCompletion should be a Python list/dict, NOT a string\n4. n8n expressions (like `={{$json['messages']}}`) are for REAL nodes (Slack, Sheets)\n5. For PSEUDO nodes (aiCompletion), construct data in workflow, extract in action with expression\n\nPATTERN 2: If You MUST Use Imports\nIf you absolutely need json module or other imports, place them INSIDE the function:\n\n```python\ndef mainWorkflow(trigger_input: List[Dict]):\n    import json  # Import INSIDE the function\n    import re\n\n    # Now you can use json.dumps(), re.search(), etc.\n    ...\n```\n\nDO NOT place imports in docstrings or outside function definitions.\n\n‚ö†Ô∏è CODE VALIDATION RULES ‚ö†Ô∏è\n\nBefore submitting workflow code, verify:\n1. ‚úÖ NO `import` statements outside functions\n2. ‚úÖ NO `json.dumps()` when building aiCompletion input\n3. ‚úÖ aiCompletion receives list of dicts with `messages` key containing list/dict data\n4. ‚úÖ Each dict in the input list = one AI call\n5. ‚úÖ Return values are always lists, never single dicts\n6. ‚úÖ Imports (if needed) are INSIDE function body\n\nüö® CRITICAL: User Requirement Precision Rules üö®\n\nNEVER use hardcoded values that contradict user requirements!\n\n‚ùå WRONG - Hardcoded count ignores user requirement:\nUser query: \"Get 4 technology news headlines\"\n```python\ndef mainWorkflow(trigger_input):\n    news_output = action_0(trigger_input)  # Fetches 10 items\n    articles = news_output[0]['json']['articles']\n    first_three = articles[:3]  # ‚ùå WRONG! User asked for 4, not 3!\n    ...\n```\n\n‚úÖ CORRECT - Use exact count from user requirement:\nUser query: \"Get 4 technology news headlines\"\n```python\ndef mainWorkflow(trigger_input):\n    news_output = action_0(trigger_input)  # Fetches items\n    articles = news_output[0]['json']['articles']\n    # Use exactly 4 as user requested\n    for i, article in enumerate(articles[:4], start=1):  # ‚úÖ Correct!\n        ...\n```\n\nRULE: When user specifies a number (e.g., \"4 news\", \"top 5 items\", \"first 3 results\"):\n1. Configure API calls to request AT LEAST that many items\n2. Process EXACTLY that many items in the workflow\n3. NEVER substitute your own number (like [:3] when user asked for 4)\n4. If API returns fewer items, process all available items (don't crash)\n\nExample requirements mapping:\n- \"4 technology news\" ‚Üí pageSize=4 or higher, process [:4]\n- \"top 5 items\" ‚Üí pageSize=5 or higher, process [:5]\n- \"first 3 results\" ‚Üí pageSize=3 or higher, process [:3]\n- \"10 headlines\" ‚Üí pageSize=10, process [:10]\n\nüö® CRITICAL: workflow_implment Tool Behavior üö®\n\nIMPORTANT: The workflow_implment tool REPLACES all workflow functions!\n\nWhen you call workflow_implment with workflow_name=\"mainWorkflow\":\n- You must provide the COMPLETE code for ALL functions in the workflow\n- This includes: trigger_0, action_0, action_1, mainWorkflow, etc.\n- The tool will REPLACE the entire workflow code with your provided code\n- DO NOT define the same function twice in your code!\n\n‚ùå WRONG - Duplicate function definitions:\n```python\ndef trigger_0():  # First definition\n    params = {}\n    function = transparent_trigger(...)\n    return function.run(input_data=None, params=params)\n\ndef action_0(input_data):\n    ...\n\ndef trigger_0(input_data):  # ‚ùå DUPLICATE! This creates two trigger_0 functions!\n    params = {}\n    function = transparent_trigger(...)\n    return function.run(input_data=input_data, params=params)\n\ndef mainWorkflow(trigger_input):\n    ...\n```\n\n‚úÖ CORRECT - Each function defined only once:\n```python\ndef trigger_0():  # Only ONE definition\n    params = {}\n    function = transparent_trigger(...)\n    return function.run(input_data=None, params=params)\n\ndef action_0(input_data):\n    ...\n\ndef action_1(input_data):\n    ...\n\ndef mainWorkflow(trigger_input):\n    ...\n```\n\nRULE: Before calling workflow_implment:\n1. Review the current code to see which functions exist\n2. Include each function EXACTLY ONCE in your new code\n3. If you need to modify a function, replace its definition entirely\n4. DO NOT copy-paste a function and then modify it - that creates duplicates!\n5. Verify no function name appears twice in your code\n\nüö® CRITICAL: Task Completion Rules üö®\n\nCall task_submit IMMEDIATELY when ALL of these conditions are met:\n1. ‚úÖ All functions are defined and implemented\n2. ‚úÖ Workflow runs successfully (Status: FunctionExecuteSuccess)\n3. ‚úÖ Output matches user requirements (correct data sent to target)\n4. ‚úÖ No errors in the last execution\n\nDO NOT continue refining/testing after success - call task_submit!\n\n‚ùå WRONG - Continuing after successful execution:\n```\nLast execution: FunctionExecuteSuccess\nOutput: [3 messages sent to Slack successfully]\nNext action: Let me test one more time... # ‚ùå STOP! Call task_submit!\n```\n\n‚úÖ CORRECT - Submit immediately after success:\n```\nLast execution: FunctionExecuteSuccess\nOutput: [3 messages sent to Slack successfully]\nNext action: task_submit  # ‚úÖ Task is complete!\n```\n\nEXCEPTION: If the output is WRONG (e.g., user asked for 4 items but only 3 were sent),\nDO NOT call task_submit - fix the issue first!\n\nExample scenario:\n- User query: \"Get 4 technology news headlines\"\n- Workflow sends: 3 messages to Slack\n- Status: FunctionExecuteSuccess (technically worked)\n- Action: DON'T submit! Fix workflow to send 4 items instead of 3\n\nRULE: Always verify output matches user requirements before calling task_submit:\n- User asked for 4 items? Check workflow sends exactly 4\n- User asked for specific format? Verify format matches\n- User asked for specific channel? Confirm correct destination\n"
      },
      {
        "role": "system",
        "content": "The user query:\nWhenever I trigger the Manual Trigger, execute the workflow, which first download a file from Google Drive, and then sends parts of its content to slack.\n- 1. Use googleDrive to download the file 'abc-news_chunked_1day_articles_2025-11-11_1.csv' under folder 'ProAgentWorkspace'\n- 1.2 Search instruction: Use folder name to search for the specific folder.\n- 1.3 Download instruction: Use fileId to download the file.\n- 2.1 Decode the Base64 file content to get actual text\n- 2.2 The first line of this file is the schema for this csv file, Extract the schema\n- 2.3 Send the schema to Slack channel #news\n- 3. Message format: 'abc-news_chunked_1day_articles_2025-11-11_1.csv schema:\n [schema]'\n\nYou have access to use the following actions and triggers:\n\n1.integration=googleDrive: Access data on Google Drive\n  1.1: action(resource=file, operation=copy): Create a copy of an existing file\n  1.2: action(resource=file, operation=createFromText): Create a file from a provided text\n  1.3: action(resource=file, operation=deleteFile): Permanently delete a file\n  1.4: action(resource=file, operation=download): Download a file\n  1.5: action(resource=file, operation=move): Move a file to another folder\n  1.6: action(resource=file, operation=share): Add sharing permissions to a file\n  1.7: action(resource=file, operation=update): Update a file\n  1.8: action(resource=file, operation=upload): Upload an existing file to Google Drive\n  1.9: action(resource=file, operation=__CUSTOM_API_CALL__)\n  1.10: action(resource=fileFolder, operation=search): Search or list files and folders\n  1.11: action(resource=fileFolder, operation=__CUSTOM_API_CALL__)\n  1.12: action(resource=folder, operation=create): Create a folder\n  1.13: action(resource=folder, operation=deleteFolder): Permanently delete a folder\n  1.14: action(resource=folder, operation=share): Add sharing permissions to a folder\n  1.15: action(resource=folder, operation=__CUSTOM_API_CALL__)\n  1.16: action(resource=drive, operation=create): Create a shared drive\n  1.17: action(resource=drive, operation=deleteDrive): Permanently delete a shared drive\n  1.18: action(resource=drive, operation=get): Get a shared drive\n  1.19: action(resource=drive, operation=list): Get the list of shared drives\n  1.20: action(resource=drive, operation=update): Update a shared drive\n  1.21: action(resource=drive, operation=__CUSTOM_API_CALL__)\n2.integration=gmail: Consume the Gmail API\n  2.1: action(resource=message, operation=send)\n3.integration=googleSheets: Read, update and write data to Google Sheets\n  3.1: action(resource=sheet, operation=read): Read all rows in a sheet\n4.integration=httpRequest: Makes an HTTP request and returns the response data\n  4.1: action(resource=default, operation=default)\n5.integration=manualTrigger: Runs the flow on clicking a button in n8n\n  5.1: trigger(resource=default, operation=default)\n6.integration=mongoDb: Find, insert and update documents in MongoDB\n  6.1: action(resource=default, operation=find): Find documents\n7.integration=n8nTrainingCustomerDatastore: Dummy node used for n8n training\n  7.1: action(resource=default, operation=getOnePerson)\n  7.2: action(resource=default, operation=getAllPeople)\n8.integration=n8nTrainingCustomerMessenger: Dummy node used for n8n training\n  8.1: action(resource=default, operation=default)\n9.integration=openWeatherMap: Gets current and future weather information\n  9.1: action(resource=default, operation=currentWeather): Returns the current weather data\n  9.2: action(resource=default, operation=5DayForecast): Returns the weather data for the next 5 days\n10.integration=postgres: Get, add and update data in Postgres\n  10.1: action(resource=database, operation=deleteTable): Delete an entire table or rows in a table\n  10.2: action(resource=database, operation=executeQuery): Execute an SQL query\n  10.3: action(resource=database, operation=insert): Insert rows in a table\n  10.4: action(resource=database, operation=upsert): Insert or update rows in a table\n  10.5: action(resource=database, operation=select): Select rows from a table\n  10.6: action(resource=database, operation=update): Update rows in a table\n11.integration=slack: Consume Slack API\n  11.1: action(resource=message, operation=post)\n12.integration=aiCompletion: Use GPT from openAi to complete language tasks.\n  12.1: action(resource=default, operation=default)\n"
      },
      {
        "role": "system",
        "content": "In the following messages, three previous assistant response with tool output are given."
      },
      null,
      {
        "role": "user",
        "content": "{\"result\": [\"function_0 defined SUCCESS: manualTrigger->default->default\", \"function_1 defined SUCCESS: googleDrive->fileFolder->search\", \"function_2 defined SUCCESS: googleDrive->fileFolder->search\", \"function_3 defined SUCCESS: googleDrive->file->download\", \"function_4 defined SUCCESS: slack->message->post\"], \"status\": \"ToolCallSuccess\"}"
      },
      null,
      {
        "role": "user",
        "content": "{\"error\": \"Undefined property \\\"mimeType\\\" for params[\\\"filter\\\"], supported properties: ['driveId', 'folderId', 'whatToSearch', 'includeTrashed']\", \"result\": \"Nothing Happened\", \"status\": \"UndefinedParam\"}"
      },
      null,
      {
        "role": "user",
        "content": "{\"result\": [\"params[\\\"searchMethod\\\"] parsed as normal-string\", \"params[\\\"queryString\\\"] parsed as expression\", \"params[\\\"returnAll\\\"] parsed as fixed_value\", \"params[\\\"limit\\\"] parsed as fixed_value\"], \"status\": \"ToolCallSuccess\"}"
      },
      null,
      {
        "role": "user",
        "content": "{\"result\": [\"params[\\\"searchMethod\\\"] parsed as normal-string\", \"params[\\\"queryString\\\"] parsed as expression\", \"params[\\\"returnAll\\\"] parsed as fixed_value\", \"params[\\\"limit\\\"] parsed as fixed_value\"], \"status\": \"ToolCallSuccess\"}"
      },
      null,
      {
        "role": "user",
        "content": "{\"result\": \"mainWorkflow has been re-implemented\", \"status\": \"ToolCallSuccess\"}"
      },
      {
        "role": "user",
        "content": "Now the codes looks like this:\n```\n\"\"\"Function param descriptions: \nThis function doesn't need params\n\nThis function has been executed for 2 times. Last execution:\n1.Status: FunctionExecuteSuccess\n2.Input: \n[{'json': {}}]\n\n3.Output:\n[{'json': {}, 'pairedItem': {'item': 0}}]\n\"\"\"\ndef trigger_0(input_data):\n  \"\"\"\n  comments: Trigger the workflow manually\n  TODOs: \n    - Test the manual trigger\n    - Use it as the main workflow trigger\n  \"\"\"\n  params = {}\n  function = transparent_trigger(integration=\"manualTrigger\", resource=\"default\", operation=\"default\")\n  output_data = function.run(input_data=None, params=params)\n  return output_data\n\n\n\n\"\"\"Function param descriptions: \n0 params[\"searchMethod\"]: enum[string] = \"name\": Search Method. Whether to search for the file/folder name or use a query string . Available values:\n  0.0 value==\"name\": Search File/Folder Name\n  0.1 value==\"query\": Advanced Search\n1 params[\"queryString\"]: string = \"\", Activate(Not Required) when (searchMethod in ['query']), otherwise do not provide: Query String. Use the Google query strings syntax to search for a specific set of files or folders. <a href=\"https://developers.google.com/drive/api/v3/search-files\" target=\"_blank\">Learn more</a>.(e.g. not name contains 'hello')\n2 params[\"returnAll\"]: boolean = False: Return All. Whether to return all results or only up to a given limit\n3 params[\"limit\"]: number = 50, Activate(Not Required) when (returnAll in [False]), otherwise do not provide: Limit. Max number of results to return\n4 params[\"filter\"]: dict = {}: Filter(Add Filter) . properties description:\n  ...hidden...\n5 params[\"options\"]: dict = {}: Options(Add Option) . properties description:\n  ...hidden...\n\nThis function has been executed for 1 times. Last execution:\n1.Status: FunctionExecuteSuccess\n2.Input: \n[{'json': {}, 'pairedItem': {'item': 0}}]\n\n3.Output:\n[{'json': {'id': '1Y27C7b4gHe4gLmlcD8rJhFDObez0U4Pe', 'name': 'ProAgentWorkspace'}, 'pairedItem': {'item': 0}}]\n\"\"\"\ndef action_0(input_data):\n  \"\"\"\n  comments: Search for the folder 'ProAgentWorkspace' by name using query string in Google Drive\n  TODOs: \n    - Test folder search result with query string\n    - Handle multiple results if needed\n  \"\"\"\n  params = { 'limit': 1,\n             'queryString': \"=name = 'ProAgentWorkspace' and mimeType = 'application/vnd.google-apps.folder' and trashed = false\",\n             'returnAll': False,\n             'searchMethod': 'query'}\n  function = transparent_action(integration=\"googleDrive\", resource=\"fileFolder\", operation=\"search\")\n  output_data = function.run(input_data=input_data, params=params)\n  return output_data\n\n\n\n\"\"\"Function param descriptions: \n0 params[\"searchMethod\"]: enum[string] = \"name\": Search Method. Whether to search for the file/folder name or use a query string . Available values:\n  0.0 value==\"name\": Search File/Folder Name\n  0.1 value==\"query\": Advanced Search\n1 params[\"queryString\"]: string = \"\", Activate(Not Required) when (searchMethod in ['query']), otherwise do not provide: Query String. Use the Google query strings syntax to search for a specific set of files or folders. <a href=\"https://developers.google.com/drive/api/v3/search-files\" target=\"_blank\">Learn more</a>.(e.g. not name contains 'hello')\n2 params[\"returnAll\"]: boolean = False: Return All. Whether to return all results or only up to a given limit\n3 params[\"limit\"]: number = 50, Activate(Not Required) when (returnAll in [False]), otherwise do not provide: Limit. Max number of results to return\n4 params[\"filter\"]: dict = {}: Filter(Add Filter) . properties description:\n  ...hidden...\n5 params[\"options\"]: dict = {}: Options(Add Option) . properties description:\n  ...hidden...\n\nThis function has been executed for 1 times. Last execution:\n1.Status: FunctionExecuteSuccess\n2.Input: \n[{'json': {'folderId': '1Y27C7b4gHe4gLmlcD8rJhFDObez0U4Pe'}}]\n\n3.Output:\n[{'json': {'id': '1-ZdMcy9RHenVKWkzmXGVqf7TOumVQ_Km', 'name': 'abc-news_chunked_1day_articles_2025-11-11_1.csv'}, 'pairedItem': {'item': 0}}]\n\"\"\"\ndef action_1(input_data):\n  \"\"\"\n  comments: Search for the file 'abc-news_chunked_1day_articles_2025-11-11_1.csv' inside the folder 'ProAgentWorkspace' by folderId using query string in Google Drive\n  TODOs: \n    - Test file search result\n    - Verify folderId is correctly passed\n  \"\"\"\n  params = { 'limit': 1,\n             'queryString': '=name = \\'abc-news_chunked_1day_articles_2025-11-11_1.csv\\' and \\'{{$json[\"folderId\"]}}\\' in parents '\n                            'and trashed = false',\n             'returnAll': False,\n             'searchMethod': 'query'}\n  function = transparent_action(integration=\"googleDrive\", resource=\"fileFolder\", operation=\"search\")\n  output_data = function.run(input_data=input_data, params=params)\n  return output_data\n\n\n\n\"\"\"Function param descriptions: \n0 params[\"fileId\"]: dict{\"mode\":enum(str),\"values\":any} = {'mode': 'list', 'value': ''}, Required: File. The file to download . \"mode\" should be one of ['url', 'id']: \n  0.0 params[\"fileId\"][\"value\"](when \"mode\"=\"url\"): string: Link(e.g. https://drive.google.com/file/d/1anGBg0b5re2VtF2bKu201_a-Vnz5BHq9Y4r-yBDAj5A/edit)\n  0.1 params[\"fileId\"][\"value\"](when \"mode\"=\"id\"): string: ID(e.g. 1anGBg0b5re2VtF2bKu201_a-Vnz5BHq9Y4r-yBDAj5A)\n1 params[\"options\"]: dict = {}: Options(Add Option) . properties description:\n  ...hidden...\n\nThis function has been executed for 1 times. Last execution:\n1.Status: ErrorRaisedHere\n2.Input: \n[{'json': {'id': '1-ZdMcy9RHenVKWkzmXGVqf7TOumVQ_Km', 'name': 'abc-news_chunked_1day_articles_2025-11-11_1.csv'}, 'pairedItem': {'item': 0}}]\n\n3.Output:\n[]\n\"\"\"\ndef action_2(input_data):\n  \"\"\"\n  comments: Download the file from Google Drive using fileId\n  TODOs: \n    - Test file download\n    - Extract binary data\n  \"\"\"\n  params = {}  # to be Implemented\n  function = transparent_action(integration=\"googleDrive\", resource=\"file\", operation=\"download\")\n  output_data = function.run(input_data=input_data, params=params)\n  return output_data\n\n\n\n\"\"\"Function param descriptions: \n0 params[\"select\"]: enum[string] = \"\", Required: Send Message To(Select...) . Available values:\n  0.0 value==\"channel\": Channel\n  0.1 value==\"user\": User\n1 params[\"channelId\"]: dict{\"mode\":enum(str),\"values\":any} = {'mode': 'list', 'value': ''}, Required when (select in ['channel']), otherwise do not provide: Channel. The Slack channel to send to(Select a channel...) . \"mode\" should be one of ['id', 'name', 'url']: \n  1.0 params[\"channelId\"][\"value\"](when \"mode\"=\"id\"): string: By ID(C0122KQ70S7E)\n  1.1 params[\"channelId\"][\"value\"](when \"mode\"=\"name\"): string: By Name(#general)\n  1.2 params[\"channelId\"][\"value\"](when \"mode\"=\"url\"): string: By URL(https://app.slack.com/client/TS9594PZK/B0556F47Z3A)\n2 params[\"user\"]: dict{\"mode\":enum(str),\"values\":any} = {'mode': 'list', 'value': ''}, Activate(Not Required) when (select in ['user']), otherwise do not provide: User(Select a user...) . \"mode\" should be one of ['id', 'username']: \n  ...hidden...\n3 params[\"messageType\"]: enum[string] = \"text\": Message Type. Whether to send a simple text message, or use Slack‚Äôs Blocks UI builder for more sophisticated messages that include form fields, sections and more . Available values:\n  3.0 value==\"text\": Simple Text Message. Supports basic Markdown\n  3.1 value==\"block\": Blocks. Combine text, buttons, form elements, dividers and more in Slack 's visual builder\n  3.2 value==\"attachment\": Attachments\n4 params[\"text\"]: string = \"\", Activate(Not Required) when (messageType in ['block']), otherwise do not provide: Notification Text. Fallback text to display in slack notifications. Supports <a href=\"https://api.slack.com/reference/surfaces/formatting\">markdown</a> by default - this can be disabled in \"Options\".\n5 params[\"blocksUi\"]: string = \"\", Required when (messageType in ['block']), otherwise do not provide: Blocks. Enter the JSON output from Slack's visual Block Kit Builder here. You can then use expressions to add variable content to your blocks. To create blocks, use <a target='_blank' href='https://app.slack.com/block-kit-builder'>Slack's Block Kit Builder</a>\n6 params[\"attachments\"]: list[dict] = [{}], Activate(Not Required) when (messageType in ['attachment']), otherwise do not provide: Attachments(Add attachment item) . properties description:\n  ...hidden...\n7 params[\"otherOptions\"]: dict = {}: Options. Other options to set(Add options) . properties description:\n  ...hidden...\n\nThis function has been executed for 0 times. Last execution:\n1.Status: DidNotBeenCalled\n2.Input: \n[]\n\n3.Output:\n[]\n\"\"\"\ndef action_3(input_data):\n  \"\"\"\n  comments: Send the extracted schema text to Slack channel #news\n  TODOs: \n    - Format message text\n    - Test Slack message sending\n  \"\"\"\n  params = {}  # to be Implemented\n  function = transparent_action(integration=\"slack\", resource=\"message\", operation=\"post\")\n  output_data = function.run(input_data=input_data, params=params)\n  return output_data\n\n\n\n\"\"\"\n\nThis function has been executed for 1 times. Last execution:\n1.Status: ErrorRaisedInner\n2.Input: \n[{'json': {}}]\n\n3.Output:\n[]\n\"\"\"\ndef mainWorkflow(trigger_input: [{...}]):\n  \"\"\"\n  comments: Workflow to download a specific file from Google Drive, extract its schema, and send to Slack #news channel\n  TODOs: \n    - Test end-to-end workflow\n    - Handle empty search results gracefully\n  \"\"\"\n  # Step 1: Trigger manual\n  manual_output = trigger_0(trigger_input)\n\n  # Step 2: Search folder\n  folder_output = action_0(manual_output)\n  if not folder_output or len(folder_output) == 0:\n    raise Exception(\"Folder 'ProAgentWorkspace' not found\")\n\n  folder_id = folder_output[0]['json']['id']\n\n  # Step 3: Search file inside folder\n  file_search_input = [{\"json\": {\"folderId\": folder_id}}]\n  file_output = action_1(file_search_input)\n  if not file_output or len(file_output) == 0:\n    raise Exception(\"File 'abc-news_chunked_1day_articles_2025-11-11_1.csv' not found\")\n\n  file_id = file_output[0]['json']['id']\n\n  # Step 4: Download file\n  download_input = file_output  # pass directly because params use {{$json[\"id\"]}}\n  download_output = action_2(download_input)\n  if not download_output or len(download_output) == 0:\n    raise Exception(\"Failed to download file\")\n\n  # Step 5: Extract and decode Base64 content\n  base64_content = download_output[0].get('binary', {}).get('data', {}).get('data')\n  if not base64_content:\n    raise Exception(\"No binary content found in downloaded file\")\n\n  import base64\n  file_bytes = base64.b64decode(base64_content)\n  file_text = file_bytes.decode('utf-8')\n\n  # Step 6: Extract first line as schema\n  first_line = file_text.splitlines()[0] if file_text else \"\"\n\n  # Step 7: Format message\n  filename = 'abc-news_chunked_1day_articles_2025-11-11_1.csv'\n  message_text = f\"{filename} schema:\\n{first_line}\"\n\n  # Step 8: Send to Slack\n  slack_input = [{\"json\": {\"text\": message_text}}]\n  slack_output = action_3(slack_input)\n\n  return slack_output\n\n\n\n\"\"\"\n\nThe directly running result for now codes with print results are as following:\n\n\nNote: if there is 'KeyError' in the error message, it may be due to the wrong usage of output data. The output data info may help you: \n[Output Data Info]\nthe output data of function `trigger_0` is: `[{'json': {}, 'pairedItem': {'item': 0}}]`\nthe output data of function `action_0` is: `[{'json': {'id': '1Y27C7b4gHe4gLmlcD8rJhFDObez0U4Pe', 'name': 'ProAgentWorkspace'}, 'pairedItem': {'item': 0}}]`\nthe output data of function `action_1` is: `[{'json': {'id': '1-ZdMcy9RHenVKWkzmXGVqf7TOumVQ_Km', 'name': 'abc-news_chunked_1day_articles_2025-11-11_1.csv'}, 'pairedItem': {'item': 0}}]`\nthe output data of function `action_2` is: `[]`\nthe output data of function `action_3` is: `[]`\n\n------------------------\nIn Function: mainWorkflow\n      download_input = file_output  # pass directly because params use {{$json[\"id\"]}}\n-->   download_output = action_2(download_input)\n      if not download_output or len(download_output) == 0:\n------------------------\nIn Function: transparent_action\n      function = transparent_action(integration=\"googleDrive\", resource=\"file\", operation=\"download\")\n-->   output_data = function.run(input_data=input_data, params=params)\n      return output_data\n------------------------\nn8nRunningException: Execution Failed: \nOutput: Problem with execution 2424: The workflow has issues and cannot be executed for that reason. Please fix them first.. Aborting.\nThe workflow has issues and cannot be executed for that reason. Please fix them first. (execution 2424)\nError executing workflow. See log messages for details.\n\nExecution error:\n====================================\nThe workflow has issues and cannot be executed for that reason. Please fix them first.\nundefined\nWorkflowHasIssuesError: The workflow has issues and cannot be executed for that reason. Please fix them first.\n    at WorkflowExecute.checkForWorkflowIssues (/Users/qwuqwuqwu/.nvm/versions/node/v22.21.0/lib/node_modules/n8n/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1382:10)\n    at WorkflowExecute.processRunExecutionData (/Users/qwuqwuqwu/.nvm/versions/node/v22.21.0/lib/node_modules/n8n/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1461:8)\n    at WorkflowExecute.run (/Users/qwuqwuqwu/.nvm/versions/node/v22.21.0/lib/node_modules/n8n/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:176:15)\n    at ManualExecutionService.runManually (/Users/qwuqwuqwu/.nvm/versions/node/v22.21.0/lib/node_modules/n8n/src/manual-execution.service.ts:157:27)\n    at WorkflowRunner.runMainProcess (/Users/qwuqwuqwu/.nvm/versions/node/v22.21.0/lib/node_modules/n8n/src/workflow-runner.ts:298:53)\n    at WorkflowRunner.run (/Users/qwuqwuqwu/.nvm/versions/node/v22.21.0/lib/node_modules/n8n/src/workflow-runner.ts:175:4)\n    at Execute.run (/Users/qwuqwuqwu/.nvm/versions/node/v22.21.0/lib/node_modules/n8n/src/commands/execute.ts:95:23)\n    at CommandRegistry.execute (/Users/qwuqwuqwu/.nvm/versions/node/v22.21.0/lib/node_modules/n8n/src/command-registry.ts:67:4)\n    at /Users/qwuqwuqwu/.nvm/versions/node/v22.21.0/lib/node_modules/n8n/bin/n8n:63:2\nThe workflow has issues and cannot be executed for that reason. Please fix them first.\n\n\nYou can also see the runnning result for all functions in there comments.\n\"\"\"\n```\n\n\n\nGive your next action together with thought, plans and criticisim:\n"
      }
    ],
    "functions": [
      {
        "name": "function_define",
        "description": "define a list of functions, each one must specify the given (integration-resource-action)",
        "parameters": {
          "type": "object",
          "properties": {
            "thought": {
              "type": "string",
              "description": "Why you choose this function"
            },
            "plan": {
              "type": "array",
              "description": "What will you do in the following steps",
              "items": {
                "type": "string"
              }
            },
            "criticism": {
              "type": "string",
              "description": "What main weakness does the current plan have"
            },
            "functions": {
              "type": "array",
              "description": "the newly defined functions.",
              "items": {
                "type": "object",
                "properties": {
                  "integration_name": {
                    "type": "string"
                  },
                  "resource_name": {
                    "type": "string"
                  },
                  "operation_name": {
                    "type": "string"
                  },
                  "comments": {
                    "type": "string",
                    "description": "This will be shown to the user, how will you use this node in the workflow"
                  },
                  "TODO": {
                    "type": "array",
                    "description": "The function didn't have implemented yet. List what you will do to further implement, test and refine this function",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": [
                  "integration_name",
                  "resource_name",
                  "operation_name",
                  "comments",
                  "TODO"
                ]
              }
            }
          },
          "required": [
            "thought",
            "plan",
            "criticism",
            "functions"
          ]
        }
      },
      {
        "name": "function_rewrite_params",
        "description": "Give params of a already defined function with the provided param descriptions, This will overwrite now params. ALL parameters are mandatory!",
        "parameters": {
          "type": "object",
          "properties": {
            "thought": {
              "type": "string",
              "description": "Why you choose this function"
            },
            "plan": {
              "type": "array",
              "description": "What will you do in the following steps",
              "items": {
                "type": "string"
              }
            },
            "criticism": {
              "type": "string",
              "description": "What main weakness does the current plan have"
            },
            "function_name": {
              "type": "string",
              "description": "Such as 'Action_x' or 'Trigger_x'. Must be a already defined function."
            },
            "params": {
              "type": "string",
              "description": "The json object of the input params. The field descriptions should refer to the Function defination in the code"
            },
            "comments": {
              "type": "string",
              "description": "This will be shown to the user, how will you use this node in the workflow"
            },
            "TODO": {
              "type": "array",
              "description": "What will you do to further implement, test and refine this function",
              "items": {
                "type": "string"
              }
            }
          },
          "required": [
            "thought",
            "plan",
            "criticism",
            "function_name",
            "params",
            "comments",
            "TODO"
          ]
        }
      },
      {
        "name": "workflow_implment",
        "description": "Implement a workflow, directly write the output of the workflow, staring with \"def mainWorkflow...\" or \"def subworkflow_xxx...\"",
        "parameters": {
          "type": "object",
          "properties": {
            "thought": {
              "type": "string",
              "description": "Why you choose this function"
            },
            "plan": {
              "type": "array",
              "description": "What will you do in the following steps",
              "items": {
                "type": "string"
              }
            },
            "criticism": {
              "type": "string",
              "description": "What main weakness does the current plan have"
            },
            "workflow_name": {
              "type": "string",
              "description": "the newly implemented workflow. If this workflow exists, we will overwrite it. All names must be \"mainWorkflow\" or \"subworkflow_x\""
            },
            "code": {
              "type": "string",
              "description": "Write the python code of the workflow. We will check you have \"comments\" and \"TODOs\". Input of mainWorkflow should always be trigger_input, Input of subworkflows should always be father_workflow_input"
            }
          },
          "required": [
            "thought",
            "plan",
            "criticism",
            "workflow_name",
            "code"
          ]
        }
      },
      {
        "name": "ask_user_help",
        "description": "Call this function when you think you can't solve some problems. You can ask user for help.",
        "parameters": {
          "type": "object",
          "properties": {
            "problems": {
              "type": "string",
              "description": "Tell what problem you are confronted with to user and ask for help."
            }
          }
        }
      },
      {
        "name": "task_submit",
        "description": "Call this function when you think you have finished the task. User will give you some feedback that can help you make your workflow better.",
        "parameters": {
          "type": "object",
          "properties": {
            "result": {
              "type": "string",
              "description": "Tell what you have done to user. Use Markdown format."
            }
          }
        }
      }
    ],
    "function_call": null,
    "stop": null,
    "other_args": {}
  },
  "output": {
    "id": "chatcmpl-CjPKfGbIgvvaVY26dhEXQYFeJWJDq",
    "object": "chat.completion",
    "created": 1764938173,
    "model": "gpt-4.1-mini-2025-04-14",
    "choices": [
      {
        "index": 0,
        "message": {
          "role": "assistant",
          "content": null,
          "function_call": {
            "name": "function_rewrite_params",
            "arguments": "{\"thought\":\"The download action failed because the params for the download action are not set. I need to provide the correct 'fileId' parameter with the correct mode and value expression to download the file by its ID.\",\"plan\":[\"Set params with 'fileId' field, mode as 'id' and value as '={{$json[\\\"id\\\"]}}' to use the file ID from input data\",\"Test the download action to ensure it returns the binary content\"],\"criticism\":\"Currently, the download action is missing params, causing execution failure. Providing correct params should fix this issue.\",\"function_name\":\"action_2\",\"params\":\"{\\\"fileId\\\":{\\\"mode\\\":\\\"id\\\",\\\"value\\\":\\\"={{$json[\\\\\\\"id\\\\\\\"]}}\\\"}}\",\"comments\":\"Download the file from Google Drive using fileId extracted from file search output\",\"TODO\":[\"Test file download\",\"Extract binary content for further processing\"]}"
          },
          "refusal": null,
          "annotations": []
        },
        "logprobs": null,
        "finish_reason": "function_call"
      }
    ],
    "usage": {
      "prompt_tokens": 20373,
      "completion_tokens": 193,
      "total_tokens": 20566,
      "prompt_tokens_details": {
        "cached_tokens": 14336,
        "audio_tokens": 0
      },
      "completion_tokens_details": {
        "reasoning_tokens": 0,
        "audio_tokens": 0,
        "accepted_prediction_tokens": 0,
        "rejected_prediction_tokens": 0
      }
    },
    "service_tier": "default",
    "system_fingerprint": "fp_9766e549b2"
  },
  "llm_interface_id": 5
}